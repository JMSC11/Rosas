{% load static i18n jazzmin django_extras %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Estadísticas</title>
    <link rel="stylesheet" href="{% static 'css/atropos.min.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

</head>

<body class="bg-[#EFEAE4] font-sans leading-normal tracking-normal">
    <div class="flex flex-col md:flex-row">
        <div class="main-content flex-1 bg-gray-100 pb-24 md:pb-5">
            <div class="bg-[#273a68] p-4 shadow text-2xl text-white">
                <h3 class="font-bold">Estadísticas</h3>
            </div>
            <div class="container mx-auto p-8">
                <h2 class="text-3xl font-bold text-center mb-8">Detalles de la categoría: {{ nombre_categoria }}</h2>
                {% for curso in cursos %}
                <div class="mb-10">
                    <h3 class="text-xl font-bold mb-2">{{ curso.curso }}</h3>
                    <p>{{ curso.descripcion }}</p>
                    <div class="flex md:flex-row flex-col justify-center items-center">
                        <div class="w-full md:w-1/2 p-4">
                            <p>Adolescentes Inscritos: {{ curso.adolescentes_inscritos }}</p>
                            {% if curso.adolescentes_inscritos > 0 %}
                            <div>
                                <h4>Adolescentes por Fundación:</h4>
                                <canvas id="pieChart-{{ curso.id }}" class="max-w-md mx-auto"></canvas>
                            </div>
                            {% else %}
                            <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4" role="alert">
                                <p class="font-bold">Información</p>
                                <p>No hay adolescentes inscritos en este curso actualmente.</p>
                            </div>
                            {% endif %}
                        </div>
                        <div class="w-1/2 mt-5">
                            {% if curso.adolescentes_inscritos > 0 %}
                            <div class="mb-5 mt-5">
                                <h4>Adolescentes Destacadas por Fundación:</h4>
                                <ul class="list-none pl-0">
                                    {% for ad in adolescentes_destacados|get_item:curso.id %}
                                    <li class="flex items-center bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-2 shadow-sm">
                                        <i class="fas fa-trophy text-yellow-400 mr-2"></i> {{ ad.nombre_completo }} - {{ ad.fundacion }}
                                    </li>
                                    {% endfor %}
                                </ul>                                       
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <script>
        // Asegúrate de que el objeto global para las gráficas existe
        window.myCharts = window.myCharts || {};
    
        {% for curso in cursos %}
        // Solo ejecutar el código de la gráfica si hay adolescentes inscritos
        {% if curso.adolescentes_inscritos > 0 %}
        (function() {
            var ctx = document.getElementById('pieChart-{{ curso.id }}').getContext('2d');
            var data = {
                labels: [
                    {% for fundacion in detalle_adolescentes_por_fundacion|get_item:curso.id %}
                    "{{ fundacion.fundacion__nombre_fundacion }}",
                    {% endfor %}
                ],
                datasets: [{
                    data: [
                        {% for fundacion in detalle_adolescentes_por_fundacion|get_item:curso.id %}
                        {{ fundacion.cantidad }},
                        {% endfor %}
                    ],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            };
    
            // Destruir gráfica anterior si existe
            if (window.myCharts['chart-{{ curso.id }}']) {
                window.myCharts['chart-{{ curso.id }}'].destroy();
            }
    
            // Crear nueva gráfica
            window.myCharts['chart-{{ curso.id }}'] = new Chart(ctx, {
                type: 'pie',
                data: data,
                options: {
                    responsive: true,
                    legend: {
                        position: 'top',
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });
        })();
        {% endif %}
        {% endfor %}
    </script>
    
    
        
            
</body>

</html>
